---
title: "ã€Rails7ã€‘RailsAPIÃ—GraphQLã®ç’°å¢ƒæ§‹ç¯‰ã—ãŸã‚‰ã¡ã‚‡ã£ã¨è©°ã¾ã£ãŸ"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["RubyOnRails", "GraphQL", "API"]
published: true
---

ã©ã†ã‚‚ã€ãŠã„ã©ã‚“ã€‚ã§ã™

RailsÃ—GraphQLã®çµ„ã¿åˆã‚ã›ã‚’è§¦ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€å°‘ã—è©°ã¾ã£ã¦ã—ã¾ã£ãŸã®ã§ã€å‚™å¿˜éŒ²çš„ã«è¨˜äº‹ã«æ®‹ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™

# TL;DR
- RailsÃ—GraphQLã®ç’°å¢ƒæ§‹ç¯‰ã®ä»•æ–¹ãŒã‚ã‹ã‚‹
- åˆå­¦è€…ã®ç§ãŒè©°ã¾ã£ãŸã®ã§ã€åˆå­¦è€…ã®äººå¿…è¦‹ã‹ã‚‚ã—ã‚Œãªã„

# ä»Šå›ä½œæˆã—ãŸãƒªãƒã‚¸ãƒˆãƒª

https://github.com/umaidashi/rails-graphql

# ç’°å¢ƒæ§‹ç¯‰

## rubyã¨railsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³

```
$ ruby -v                
ruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]
```

```
$ rails -v       
Rails 7.0.8
```

## railsã‚¢ãƒ—ãƒªã‚’ä½œæˆ

- apiãƒ¢ãƒ¼ãƒ‰ã§ä½œã£ã¦ã„ãã¾ã™

```
$ rails new rails-graphql --api
```

## å¿…è¦ãªgemã‚’è¿½åŠ 

```
$ bundle add graphql
```

```
$ bundle add graphiql-rails
```
- 2ã¤ç›®ã¯`graphql`ã§ã¯ãªã`graphiql`ã§`i`ãŒå…¥ã£ã¦ã„ã‚‹ã®ã§æ³¨æ„ã—ã¦ä¸‹ã•ã„

## graphqlã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹

```
$ rails g graphql:install

create app/graphql/types
create app/graphql/types/.keep
...
```
- ãŸãã•ã‚“createã•ã‚Œã¾ã™

## `/graphiql`ã®routingã™ã‚‹

`gem graphiql-rails`ã®æ©Ÿèƒ½ã§ã€localhostã®IDEã‹ã‚‰ã‚¯ã‚¨ãƒªã‚’å©ã‘ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãã®ãƒ‘ã‚¹ãŒ`/graphiql`ãªã®ã§ã€`config/routes.rb`ã«è¿½åŠ ã—ã¦ã‚ã’ã¾ã™ã€‚
ã¾ãŸã€é–‹ç™ºç’°å¢ƒã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ifæ–‡ã‚’ã‹ã¾ã—ã¾ã™

```ruby:config/routes.rb
...
post "/graphql", to: "graphql#execute" # ã“ã‚Œã¯ `rails g graphql:install`ã§è¿½åŠ ã•ã‚Œã‚‹ã¯ãš

# ã“ã®ä¸‹ã‚’è¿½åŠ 
if Rails.env.development?
    mount GraphiQL::Rails::Engine, at: "/graphiql", graphql_path: "/graphql"
end
```

## ä¸€æ—¦èµ·å‹•ã—ã¦ã¿ã‚‹

```
$ rails s
```

`Routing Error`ã ã£ãŸã®ãŒã€`ActionDispatch::Request::Session::DisabledSessionError in GraphiQL::Rails::Editors#show`ã«ãªã£ã¦ã„ã‚‹ã¨ãŠã‚‚ã„ã¾ã™

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒDisabledã ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ã§æœ‰åŠ¹åŒ–ã—ã¾ã—ã‚‡ã†
`config/application.rb`ã«ä»¥ä¸‹ã®2è¡Œã‚’è¿½åŠ ã—ã¾ã™

```js:config/application.rb
config.middleware.use ActionDispatch::Cookies
config.middleware.use ActionDispatch::Session::CookieStore
```

å†èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯è§£æ¶ˆã—ã¾ã—ãŸãŒã€`Loading...`ã‹ã‚‰å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™

railsã‚’APIãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã‚‚ã†ä¸€ã¤è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™

## APIãƒ¢ãƒ¼ãƒ‰ã«å¿…è¦ãªè¨­å®šã‚’è¿½åŠ ã™ã‚‹

https://github.com/rmosolgo/graphiql-rails#note-on-api-mode
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®â†‘ã®éƒ¨åˆ†ã«è¨˜è¿°ãŒã‚ã‚Šã¾ã—ãŸ

### `config/application.rb`ã«`require "sprockets/railtie"`ã‚’è¿½åŠ ã™ã‚‹

```ruby:config/application.rb
require "rails/all"
require "sprockets/railtie" # ã“ã‚Œã‚’è¿½åŠ 
```
ã“ã®çŠ¶æ…‹ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã™ã‚‹ã¨ã€

```
$ rails s

Expected to find a manifest file in `app/assets/config/manifest.js` (Sprockets::Railtie::ManifestNeededError)
But did not, please create this file and use it to link any assets that need
to be rendered by your app:

Example:
  //= link_tree ../images
  //= link_directory ../javascripts .js
  //= link_directory ../stylesheets .css
and restart your server
```

ã“ã‚“ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Šã€`app/assets/config/manifest.js`ã‚’ä½œã£ã¦ã‚ã’ã¾ã—ã‚‡ã†

### `app/assets/config/manifest.js`ã‚’ä½œæˆã™ã‚‹

ä½œæˆã—ãŸã‚‰ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹ä»¥ä¸‹ã®2è¡Œã‚’æ›¸ãè¾¼ã¿ã¾ã—ã‚‡ã†

```ruby:app/assets/config/manifest.js
//= link graphiql/rails/application.css
//= link graphiql/rails/application.js
```

ã“ã‚Œã§ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ã€graphiqlã®IDEãŒé–‹ãã¯ãšã§ã™

## è©¦ã—ã«ãƒ†ã‚¹ãƒˆã‚¯ã‚¨ãƒªã‚’å©ã„ã¦ã¿ã‚‹

`rails g graphql:install`ã—ãŸæ™‚ç‚¹ã§ç”Ÿæˆã•ã‚ŒãŸã€`app/graphql/types/query_type.rb`ã«äºˆã‚ãƒ†ã‚¹ãƒˆã‚¯ã‚¨ãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™
è©¦ã—ã«å©ã„ã¦ã¿ã¾ã—ã‚‡ã†

![ãƒ†ã‚¹ãƒˆã‚¯ã‚¨ãƒª](/images/rails-graphql/test-query.png)

ç„¡äº‹ã«`Hello World`ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ç’°å¢ƒæ§‹ç¯‰Okã§ã™
è‡ªç”±ã«APIã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼ï¼

# ãŠã‚ã‚Šã«

ç’°å¢ƒæ§‹ç¯‰ã¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‘ã©ã€APIã‚’ä½œã‚‹ã®ã¯ã¾ãŸåˆ¥ã®è©±...
ã„ã‚ã‚“ãªã‚µãƒ¼ãƒ“ã‚¹ã§RailsãŒä½¿ã‚ã‚Œã¦ã¦æ­´å²ã‚‚ã‚ã£ã¦ã€ãªã‚“ã ã‹Railsã¯å¤¢ãŒã‚ã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸ

Railsãƒã‚¹ã‚¿ãƒ¼ã—ãŸã£ãŸã‚‹ã§ï¼
ãŠã„ã©ã‚“ã€‚ã§ã—ãŸã€œ















